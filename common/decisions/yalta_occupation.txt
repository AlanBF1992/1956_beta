CW_occupation_negotations = {
	#opening decisions - I might regret this later, but there seems little need to make this dynamic
	discuss_the_german_issue = {
		visible = {
			has_global_flag = r56_unlocked_fate_of_germany_decisions
			any_controlled_state = {
				is_core_of = GER
			}
		}
	}
 	discuss_the_austrian_issue = {
		visible = {
			has_global_flag = r56_unlocked_fate_of_germany_decisions
			any_controlled_state = {
				is_core_of = AUS
			}
		}
 	}
	occupation_of_iran_decision = {	#itd be nicer if garrison divisions existed, so the decision below this wouldnt be needed, but no data
		allowed = {
			always = no
		}
		is_good = no
		days_mission_timeout = 142
		available = {
			NOT = {
				has_subject = PER
				any_owned_state = {
					is_core_of = PER
				}
			}
		}
		timeout_effect = {	#Iran complains
			
		}
	}
	withdraw_occupation_of_iran_decision = {
		allowed = {
			OR = {
				original_tag = SOV
				original_tag = ENG
			}
		}
		available = {
			# if = {	#Ive made some scoping mistakes
			# 	limit = {
			# 		has_subject = PER
			# 	}
			# 	PER = {
			# 		NOT = {
			# 			any_owned_state = {
			# 				ROOT = {
			# 					divisions_in_state = {
			# 						size < 1
			# 						state = PREV
			# 					}
			# 				}
			# 			}
			# 		}
			# 	}
			# }
			# else = {
			# 	NOT = {
			# 		any_owned_state = {
			# 			is_core_of = PER
			# 			PREV = {
			# 				divisions_in_state = {
			# 					size < 1
			# 					state = PREV
			# 				}
			# 			}
			# 		}
			# 	}
			# }
		}
		visible = {
			PER = {
				exists = yes
			}
			OR = {
				has_subject = PER
				any_owned_state = {
					is_core_of = PER
				}
			}
		}
		remove_effect = {
			every_owned_state = {
				limit = {
					is_core_of = PER
				}
				transfer_state_to = PER
			}
			if = {
				limit = {
					has_subject = PER
				}
				set_autonomy = {
					target = PER
					autonomous_state = autonomy_free
					end_wars = no
					end_civil_wars = no
				}
				PER = {
					add_ideas = PER_anglo_iranian_oil_company
				}
			}
		}
		ai_will_do = {
			base = 1
			modifier = {
				factor = 0
				original_tag = SOV
				date < 1946.03.25	#set up puppet regimes first, let it expire
			}
			modifier = {
				factor = 0
				original_tag = ENG
				date < 1946.02.01
			}
		}
	}
	SOV_release_AZE_puppet = {

		icon = generic_nationalism

		allowed = {
			original_tag = SOV
		}

		available = {
			owns_state = 419
			owns_state = 987
			NOT = {
				AZR = {
					country_exists = yes
				}
			}
		}

		visible = {
			any_controlled_state = {
				is_core_of = PER
			}
		}

		days_remove = 45
		
		fire_only_once = yes

		remove_effect = {
			AZR = {
				transfer_state = 419
				transfer_state = 987
			}
			if = {
				limit = {
					has_dlc = "Together for Victory"
				}
				set_autonomy = {
					target = AZR
					autonomy_state = autonomy_dominion
					end_wars = no
					end_civil_wars = no
				}
			}
			else = {
				puppet = AZR
			}
		}			
		ai_will_do = {
			factor = 50
		}
	}
	SOV_release_KUR_puppet = {

		icon = generic_nationalism

		allowed = {
			original_tag = SOV
		}

		available = {
			owns_state = 988
			NOT = {
				KUR = {
					country_exists = yes
				}
			}
		}

		visible = {
			any_controlled_state = {
				is_core_of = PER
			}
		}

		days_remove = 45
		
		fire_only_once = yes

		remove_effect = {
			KUR = {
				transfer_state = 988
			}
			if = {
				limit = {
					has_dlc = "Together for Victory"
				}
				set_autonomy = {
					target = KUR
					autonomy_state = autonomy_dominion
					end_wars = no
					end_civil_wars = no
				}
			}
			else = {
				puppet = KUR
			}
		}			
		ai_will_do = {
			factor = 50
		}
	}
	SOV_withdraw_from_puppets_in_iran = {
		allowed = {
			original_tag = SOV
		}
		visible = {
			OR = {
				has_subject = AZR
				has_subject = KUR
			}
		}
		remove_effect = {
			if = {
				limit = {
					has_subject = AZR
				}
				end_puppet = AZR
				PER = {
					create_wargoal = {
						type = annex_everything
						target = AZR
					}
				}
			}
			if = {
				limit = {
					has_subject = KUR
				}
				end_puppet = KUR
				PER = {
					create_wargoal = {
						type = annex_everything
						target = KUR
					}
				}
			}
		}
		ai_will_do = {
			base = 0
			modifier = {
				add = 1
				NOT = {
					any_owned_state = {
						is_core_of = PER
					}
				}
			}
		}
	}
}